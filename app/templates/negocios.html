<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CRM - Central de Negócios (SaaS)</title>
    <!-- Tailwind CSS CDN --><script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font --><link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" rel="stylesheet">
    <!-- Chart.js CDN --><script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
    </style>
</head>
<body class="bg-gray-100">
    <!-- Barra de Navegação Superior (Simplificada) --><header class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-10">
        <div class="text-xl font-extrabold text-indigo-700">ByteVision CRM</div>
        <nav class="flex space-x-6 text-sm font-semibold">
            <!-- Rotas Flask --><a href="{{ url_for('main.kanban_board') }}" class="text-gray-600 hover:text-indigo-600 transition duration-150 pb-1">Gestão de Leads</a>
            <a href="{{ url_for('main.atendimentos_page') }}" class="text-gray-600 hover:text-indigo-600 transition duration-150 pb-1">Atendimentos</a>
            <a href="{{ url_for('main.negocios_page') }}" class="text-indigo-600 border-b-2 border-indigo-600 pb-1">Central de Negócios</a>
        </nav>
        <div class="flex items-center space-x-3">
            <button class="bg-indigo-500 text-white px-3 py-2 rounded-lg hover:bg-indigo-600 transition duration-150 shadow-md text-sm">Exportar Relatório (PDF)</button>
        </div>
    </header>

    <!-- Área de Conteúdo Principal --><main class="p-8">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">Central de Negócios (Receita e SaaS)</h1>
        
        <!-- KPIs Principais (SaaS/Software) --><div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <!-- Card 1: MRR (Receita Recorrente Mensal) --><div class="bg-white p-6 rounded-lg shadow-xl border-t-4 border-indigo-500">
                <p class="text-sm font-medium text-gray-500">MRR (Receita Recorrente Mensal)</p>
                <p class="text-4xl font-extrabold text-indigo-700 mt-1">R$ 142.500</p>
                <span class="text-green-500 text-sm font-semibold">+3.5% vs Mês Anterior</span>
            </div>
            <!-- Card 2: Clientes Ativos (Licenças) --><div class="bg-white p-6 rounded-lg shadow-xl border-t-4 border-green-500">
                <p class="text-sm font-medium text-gray-500">Clientes Ativos (SaaS)</p>
                <p class="text-4xl font-extrabold text-green-700 mt-1">215</p>
                <span class="text-green-500 text-sm font-semibold">+8 Novos (Mês)</span>
            </div>
            <!-- Card 3: Churn Rate (Cancelamentos) --><div class="bg-white p-6 rounded-lg shadow-xl border-t-4 border-red-500">
                <p class="text-sm font-medium text-gray-500">Taxa de Churn (Cancelamentos)</p>
                <p class="text-4xl font-extrabold text-red-700 mt-1">1.8%</p>
                <span class="text-green-500 text-sm font-semibold">-0.2% vs Mês Anterior</span>
            </div>
        </div>

        <!-- Gráficos Gerados com Chart.js --><div class="bg-white p-6 rounded-lg shadow-xl">
            <h2 class="text-xl font-semibold text-gray-700 mb-4">Análise de Receita (BeOrange)</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- Gráfico 1: Receita por Produto (Pizza) --><div class="p-4 border border-gray-200 rounded-lg">
                    <h3 class="font-medium text-gray-600 mb-2">MRR por Produto</h3>
                    <!-- Wrapper com altura definida -->
                    <div class="relative h-80">
                        <canvas id="mrrByProductChart"></canvas>
                    </div>
                </div>
                <!-- Gráfico 2: Novos Clientes vs Cancelamentos (Barras/Linhas) --><div class="p-4 border border-gray-200 rounded-lg">
                    <h3 class="font-medium text-gray-600 mb-2">Novos Clientes vs Churn (Últimos 6 meses)</h3>
                    <!-- Wrapper com altura definida -->
                    <div class="relative h-80">
                        <canvas id="customerChurnChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Dados Fictícios para os Gráficos
        const mrrProductData = {
            labels: ['BeOrange ERP', 'Cloud Services', 'Analytics Suite', 'Suporte Premium'],
            datasets: [{
                data: [60000, 45000, 20000, 17500], // Valores de MRR
                backgroundColor: [
                    '#4F46E5', // Indigo
                    '#22C55E', // Green
                    '#F59E0B', // Amber
                    '#EF4444'  // Red
                ],
                hoverOffset: 4
            }]
        };

        const customerChurnData = {
            labels: ['Abr', 'Mai', 'Jun', 'Jul', 'Ago', 'Set'],
            datasets: [
                {
                    label: 'Novos Clientes',
                    data: [15, 12, 18, 10, 8, 14],
                    borderColor: '#22C55E', // Green
                    backgroundColor: '#22C55E',
                    type: 'line',
                    tension: 0.3,
                    fill: false,
                    yAxisID: 'y'
                },
                {
                    label: 'Cancelamentos (Churn)',
                    data: [3, 2, 4, 1, 3, 2],
                    borderColor: '#EF4444', // Red
                    backgroundColor: '#EF4444',
                    type: 'line',
                    tension: 0.3,
                    fill: false,
                    yAxisID: 'y'
                }
            ]
        };

        // Renderizar Gráfico de Pizza (MRR por Produto)
        const mrrByProductCtx = document.getElementById('mrrByProductChart').getContext('2d');
        new Chart(mrrByProductCtx, {
            type: 'doughnut', // Pode ser 'pie' também
            data: mrrProductData,
            options: {
                responsive: true,
                maintainAspectRatio: false, // <-- Impede que o gráfico cresça verticalmente
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: false, // O título já está no HTML
                    }
                }
            },
        });

        // Renderizar Gráfico de Linha (Novos Clientes vs Churn)
        const customerChurnCtx = document.getElementById('customerChurnChart').getContext('2d');
        new Chart(customerChurnCtx, {
            type: 'bar', // Principalmente barras, mas com linhas para tendência
            data: customerChurnData,
            options: {
                responsive: true,
                maintainAspectRatio: false, // <-- Impede que o gráfico cresça verticalmente
                plugins: {
                    legend: {
                        position: 'bottom',
                    },
                    title: {
                        display: false,
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Número de Clientes'
                        }
                    }
                }
            },
        });
    </script>
</body>
</html>

